<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mi Gestor de Gastos</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh; color: #333;
        }
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        .header { text-align: center; margin-bottom: 20px; }
        .header h1 { color: white; font-size: 2.5rem; text-shadow: 0 2px 4px rgba(0,0,0,0.3); }
        .balance-card, .form-card, .chart-card, .transactions-card {
            background: white; border-radius: 20px; padding: 30px; margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        .balance-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; }
        .balance-item { text-align: center; padding: 20px; border-radius: 15px; }
        .balance-item.income { background: linear-gradient(135deg, #4CAF50, #45a049); color: white; }
        .balance-item.expense { background: linear-gradient(135deg, #f44336, #da190b); color: white; }
        .balance-item.investment { background: linear-gradient(135deg, #FF9800, #F57C00); color: white; }
        .balance-item.total { background: linear-gradient(135deg, #2196F3, #1976D2); color: white; }
        .balance-amount { font-size: 1.8rem; font-weight: bold; margin-bottom: 5px; }
        .balance-label { font-size: 0.9rem; opacity: 0.9; }
        .form-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; }
        .form-group { display: flex; flex-direction: column; }
        .form-group label { margin-bottom: 8px; font-weight: 600; color: #555; }
        .form-group input, .form-group select {
            padding: 12px; border: 2px solid #e1e5e9; border-radius: 10px; font-size: 1rem;
            transition: all 0.3s ease;
        }
        .form-group input:focus, .form-group select:focus {
            outline: none; border-color: #667eea; box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        .btn { background: linear-gradient(135deg, #667eea, #764ba2); color: white; border: none;
            padding: 15px 30px; border-radius: 10px; font-size: 1rem; font-weight: 600; cursor: pointer; width: 100%; }
        .btn:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4); }
        .charts-section { display: grid; grid-template-columns: repeat(auto-fit, minmax(400px, 1fr)); gap: 30px; }
        .chart-container { position: relative; height: 300px; }
        .transaction-item { display: flex; justify-content: space-between; align-items: center;
            padding: 15px; border-bottom: 1px solid #f0f0f0; transition: background 0.3s ease; }
        .transaction-item:hover { background: #f8f9fa; }
        .transaction-info { flex-grow: 1; }
        .transaction-description { font-weight: 600; color: #333; margin-bottom: 5px; }
        .transaction-details { font-size: 0.9rem; color: #666; }
        .transaction-amount { font-weight: bold; font-size: 1.1rem; }
        .transaction-amount.income { color: #4CAF50; }
        .transaction-amount.expense { color: #f44336; }
        .transaction-amount.investment { color: #FF9800; }
        .delete-btn { background: #f44336; color: white; border: none; padding: 5px 10px;
            border-radius: 5px; cursor: pointer; margin-left: 10px; font-size: 0.8rem; }
        .delete-btn:hover { background: #da190b; }
        .empty-state { text-align: center; padding: 40px; color: #666; }
        @media (max-width: 768px) {
            .form-grid, .balance-grid, .charts-section { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <div class="container">
        <header class="header">
            <h1>üí∞ Mi Gestor de Gastos</h1>
        </header>

        <!-- Selector de mes -->
        <div style="text-align: center; margin-bottom: 20px;">
            <label for="monthSelect" style="color: white; font-weight: bold;">üìÖ Seleccionar Mes: </label>
            <input type="month" id="monthSelect">
        </div>

        <!-- Resumen de balance -->
        <div class="balance-card">
            <div class="balance-grid">
                <div class="balance-item income"><div class="balance-amount" id="totalIncome">‚Ç¨0.00</div><div class="balance-label">Ingresos</div></div>
                <div class="balance-item expense"><div class="balance-amount" id="totalExpense">‚Ç¨0.00</div><div class="balance-label">Gastos</div></div>
                <div class="balance-item investment"><div class="balance-amount" id="totalInvestment">‚Ç¨0.00</div><div class="balance-label">Inversiones</div></div>
                <div class="balance-item total"><div class="balance-amount" id="totalBalance">‚Ç¨0.00</div><div class="balance-label">Balance Total</div></div>
            </div>
        </div>

        <!-- Formulario -->
        <div class="form-card">
            <h2 style="margin-bottom: 20px; color: #333;">A√±adir Transacci√≥n</h2>
            <form id="transactionForm">
                <div class="form-grid">
                    <div class="form-group">
                        <label for="type">Tipo</label>
                        <select id="type" required onchange="updateCategories()">
                            <option value="">Seleccionar tipo</option>
                            <option value="income">Ingreso</option>
                            <option value="expense">Gasto</option>
                            <option value="investment">Inversi√≥n</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="amount">Cantidad (‚Ç¨)</label>
                        <input type="number" id="amount" step="0.01" min="0" required>
                    </div>
                    <div class="form-group">
                        <label for="category">Categor√≠a</label>
                        <select id="category" required><option value="">Seleccionar categor√≠a</option></select>
                    </div>
                    <div class="form-group">
                        <label for="date">Fecha</label>
                        <input type="date" id="date" required>
                    </div>
                </div>
                <div class="form-group" style="margin-bottom: 20px;">
                    <label for="description">Descripci√≥n</label>
                    <input type="text" id="description" placeholder="Ej: Compra en el supermercado" required>
                </div>
                <button type="submit" class="btn">A√±adir Transacci√≥n</button>
            </form>
        </div>

        <!-- Gr√°ficos -->
        <div class="charts-section">
            <div class="chart-card"><h3>üìä Distribuci√≥n General</h3><div class="chart-container"><canvas id="generalChart"></canvas></div></div>
            <div class="chart-card"><h3>üí∏ Desglose de Gastos</h3><div class="chart-container"><canvas id="expenseChart"></canvas></div></div>
            <div class="chart-card"><h3>üí∞ Fuentes de Ingresos</h3><div class="chart-container"><canvas id="incomeChart"></canvas></div></div>
            <div class="chart-card"><h3>üìà Plataformas de Inversi√≥n</h3><div class="chart-container"><canvas id="investmentChart"></canvas></div></div>
        </div>

        <!-- Lista de transacciones -->
        <div class="transactions-card">
            <h2 style="margin-bottom: 20px; color: #333;">Transacciones Recientes</h2>
            <div id="transactionsList">
                <div class="empty-state"><h3>No hay transacciones todav√≠a</h3><p>A√±ade tu primera transacci√≥n usando el formulario de arriba</p></div>
            </div>
        </div>
    </div>

    <script>
        let transactions = JSON.parse(localStorage.getItem('transactions')) || [];
        let charts = {};

        const categories = {
            income: { 'cta': 'CTA (Comit√© de √Årbitros)', 'nomina': 'N√≥mina' },
            expense: { 'alimentacion': 'Alimentaci√≥n', 'transporte': 'Transporte', 'entretenimiento': 'Entretenimiento',
                       'salud': 'Salud', 'educacion': 'Educaci√≥n', 'vivienda': 'Vivienda', 'otros': 'Otros' },
            investment: { 'trade-republic': 'Trade Republic', 'myinvestor': 'MyInvestor', 'binance': 'Binance' }
        };

        const form = document.getElementById('transactionForm');
        const transactionsList = document.getElementById('transactionsList');
        const totalIncome = document.getElementById('totalIncome');
        const totalExpense = document.getElementById('totalExpense');
        const totalInvestment = document.getElementById('totalInvestment');
        const totalBalance = document.getElementById('totalBalance');
        const dateInput = document.getElementById('date');
        const typeSelect = document.getElementById('type');
        const categorySelect = document.getElementById('category');
        const monthSelect = document.getElementById('monthSelect');

        // Fecha actual por defecto
        dateInput.valueAsDate = new Date();
        const now = new Date();
        monthSelect.value = `${now.getFullYear()}-${String(now.getMonth()+1).padStart(2, '0')}`;

        function updateCategories() {
            const selectedType = typeSelect.value;
            categorySelect.innerHTML = '<option value="">Seleccionar categor√≠a</option>';
            if (selectedType && categories[selectedType]) {
                Object.entries(categories[selectedType]).forEach(([key, value]) => {
                    const option = document.createElement('option');
                    option.value = key; option.textContent = value;
                    categorySelect.appendChild(option);
                });
            }
        }
        function formatCurrency(amount) {
            return new Intl.NumberFormat('es-ES',{ style: 'currency', currency: 'EUR'}).format(amount);
        }
        function formatDate(dateString) {
            return new Date(dateString).toLocaleDateString('es-ES',{day: '2-digit', month: '2-digit', year: 'numeric'});
        }
        function getCategoryName(type, category) {
            return categories[type] && categories[type][category] ? categories[type][category] : category;
        }

        function getSelectedMonth() { return monthSelect.value; }
        function getFilteredTransactions() {
            const selected = getSelectedMonth();
            return transactions.filter(t => t.date.startsWith(selected));
        }

        function calculateTotals() {
            const filtered = getFilteredTransactions();
            const income = filtered.filter(t => t.type === 'income').reduce((s,t)=>s+t.amount,0);
            const expense = filtered.filter(t => t.type === 'expense').reduce((s,t)=>s+t.amount,0);
            const investment = filtered.filter(t => t.type === 'investment').reduce((s,t)=>s+t.amount,0);
            const balance = income - expense - investment;
            totalIncome.textContent = formatCurrency(income);
            totalExpense.textContent = formatCurrency(expense);
            totalInvestment.textContent = formatCurrency(investment);
            totalBalance.textContent = formatCurrency(balance);
        }

        function createGeneralChart(filtered) {
            const ctx = document.getElementById('generalChart').getContext('2d');
            const income = filtered.filter(t => t.type === 'income').reduce((s,t)=>s+t.amount,0);
            const expense = filtered.filter(t => t.type === 'expense').reduce((s,t)=>s+t.amount,0);
            const investment = filtered.filter(t => t.type === 'investment').reduce((s,t)=>s+t.amount,0);
            if (charts.general) charts.general.destroy();
            charts.general = new Chart(ctx,{ type:'doughnut',
                data:{ labels:['Ingresos','Gastos','Inversiones'], datasets:[{ data:[income,expense,investment],
                    backgroundColor:['#4CAF50','#f44336','#FF9800'], borderWidth:2, borderColor:'#fff'}]},
                options:{ responsive:true, maintainAspectRatio:false, plugins:{ legend:{ position:'bottom' } } }
            });
        }
        function createExpenseChart(filtered) {
            const ctx = document.getElementById('expenseChart').getContext('2d');
            const expenseData = {};
            filtered.filter(t => t.type === 'expense').forEach(t => {
                const name = getCategoryName(t.type,t.category);
                expenseData[name]=(expenseData[name]||0)+t.amount;
            });
            if (charts.expense) charts.expense.destroy();
            charts.expense = new Chart(ctx,{ type:'pie',
                data:{ labels:Object.keys(expenseData), datasets:[{ data:Object.values(expenseData),
                    backgroundColor:['#FF6384','#36A2EB','#FFCE56','#4BC0C0','#9966FF','#FF9F40','#8BC34A','#E91E63'],
                    borderWidth:2, borderColor:'#fff'}]},
                options:{ responsive:true, maintainAspectRatio:false, plugins:{ legend:{ position:'bottom' } } }
            });
        }
        function createIncomeChart(filtered) {
            const ctx = document.getElementById('incomeChart').getContext('2d');
            const incomeData = {};
            filtered.filter(t => t.type === 'income').forEach(t => {
                const name = getCategoryName(t.type,t.category);
                incomeData[name]=(incomeData[name]||0)+t.amount;
            });
            if (charts.income) charts.income.destroy();
            charts.income = new Chart(ctx,{ type:'bar',
                data:{ labels:Object.keys(incomeData), datasets:[{ label:'Ingresos (‚Ç¨)', data:Object.values(incomeData),
                    backgroundColor:'#4CAF50', borderColor:'#45a049', borderWidth:2 }]},
                options:{ responsive:true, maintainAspectRatio:false, plugins:{ legend:{ display:false } },
                    scales:{ y:{ beginAtZero:true } } }
            });
        }
        function createInvestmentChart(filtered) {
            const ctx = document.getElementById('investmentChart').getContext('2d');
            const investmentData = {};
            filtered.filter(t => t.type === 'investment').forEach(t => {
                const name = getCategoryName(t.type,t.category);
                investmentData[name]=(investmentData[name]||0)+t.amount;
            });
            if (charts.investment) charts.investment.destroy();
            charts.investment = new Chart(ctx,{ type:'doughnut',
                data:{ labels:Object.keys(investmentData), datasets:[{ data:Object.values(investmentData),
                    backgroundColor:['#FF9800','#FFC107','#FF5722'], borderWidth:2, borderColor:'#fff'}]},
                options:{ responsive:true, maintainAspectRatio:false, plugins:{ legend:{ position:'bottom' } } }
            });
        }

        function updateCharts() {
            const filtered = getFilteredTransactions();
            createGeneralChart(filtered);
            createExpenseChart(filtered);
            createIncomeChart(filtered);
            createInvestmentChart(filtered);
        }

        function renderTransactions() {
            const filtered = getFilteredTransactions();
            if (filtered.length === 0) {
                transactionsList.innerHTML = `<div class="empty-state"><h3>No hay transacciones este mes</h3>
                    <p>A√±ade tu primera transacci√≥n usando el formulario de arriba</p></div>`; return;
            }
            const sorted = [...filtered].sort((a,b)=>new Date(b.date)-new Date(a.date));
            transactionsList.innerHTML = sorted.map(t => `
                <div class="transaction-item">
                    <div class="transaction-info">
                        <div class="transaction-description">${t.description}</div>
                        <div class="transaction-details">${getCategoryName(t.type,t.category)} ‚Ä¢ ${formatDate(t.date)}</div>
                    </div>
                    <div style="display: flex; align-items: center;">
                        <div class="transaction-amount ${t.type}">
                            ${t.type==='income'?'+':'-'}${formatCurrency(t.amount)}
                        </div>
                        <button class="delete-btn" onclick="deleteTransaction(${t.id})">üóëÔ∏è</button>
                    </div>
                </div>`).join('');
        }

        function addTransaction(data) {
            const transaction = { id: Date.now(), ...data, amount: parseFloat(data.amount) };
            transactions.push(transaction);
            localStorage.setItem('transactions', JSON.stringify(transactions));
            renderTransactions(); calculateTotals(); updateCharts();
        }
        function deleteTransaction(id) {
            if

